#!/usr/bin/env bash

set -e

# Variables
CONFIG_DIR="${HOME}/.config/hypr"
SCRIPTS_DIR="${CONFIG_DIR}/scripts"
HYPRPAPER_CONFIG="${CONFIG_DIR}/hyprpaper.conf"
LOG_FILE="${CONFIG_DIR}/startup.log"

# Log function
log() {
    echo "$(date +'%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_FILE"
}

# Check if command exists
command_exists() {
    command -v "$1" &> /dev/null
}

# Start functions
start_dunst() {
    if command_exists dunst && ! pgrep -x dunst > /dev/null; then
        dunst &
        log "Started dunst."
    else
        log "Warning: dunst not found or already running."
    fi
}

start_waybar() {
    if command_exists "$SCRIPTS_DIR/launch_waybar" && ! pgrep -x waybar > /dev/null; then
        "$SCRIPTS_DIR/launch_waybar" &
        log "Started Waybar."
    else
        log "Warning: launch_waybar script not found or already running."
    fi
}

start_hyprpaper() {
    if command_exists hyprpaper; then
        hyprpaper load "$HYPRPAPER_CONFIG" &
        log "Loaded hyprpaper config."
    else
        log "Warning: hyprpaper not found."
    fi
}

# Additional start functions for dynamic tools, RGB, and PolicyKit...

# Start services
start_dunst
start_waybar
start_hyprpaper
# Call additional start functions...

# Update DBus environment variables
dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP &

# Send greeting notification
notify-send -a aurora "Hello, $(whoami)!"
log "Startup scripts initiated."
